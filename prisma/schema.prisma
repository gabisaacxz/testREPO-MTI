generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Site {
  id              String          @id @default(uuid()) @db.Uuid
  siteIdCode      String          @unique
  siteName        String
  locationAddress String?
  isActive        Boolean         @default(true)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  attendanceLogs  AttendanceLog[]

  @@map("sites")
}

model User {
  id                String               @id @default(uuid()) @db.Uuid
  email             String               @unique
  passwordHash      String
  firstName         String?
  lastName          String?
  role              String
  status            String?
  workStartTime     DateTime?            @db.Time(6)
  workEndTime       DateTime?            @db.Time(6)
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt
  deletedEvidence   AttendanceEvidence[] @relation("DeletedByUser")
  uploadedEvidence  AttendanceEvidence[] @relation("UploadedByUser")
  loggedAttendances AttendanceLog[]      @relation("LoggedByUser")
  attendanceLogs    AttendanceLog[]      @relation("UserAttendance")

  @@map("users")
}

model AttendanceLog {
  id             String               @id @default(uuid()) @db.Uuid
  userId         String               @db.Uuid
  siteId         String               @db.Uuid
  attendanceDate DateTime             @db.Date
  timeIn         DateTime?
  timeOut        DateTime?
  loggedByUserId String?              @db.Uuid
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt
  evidence       AttendanceEvidence[]
  loggedByUser   User?                @relation("LoggedByUser", fields: [loggedByUserId], references: [id])
  site           Site                 @relation(fields: [siteId], references: [id])
  user           User                 @relation("UserAttendance", fields: [userId], references: [id])

  @@unique([userId, attendanceDate])
  @@index([attendanceDate])
  @@index([siteId])
  @@map("attendance_logs")
}

model AttendanceEvidence {
  id               String        @id @default(uuid()) @db.Uuid
  attendanceId     String        @db.Uuid
  uploadedByUserId String        @db.Uuid
  imageUrl         String
  imageHash        String?
  imageType        String
  takenAt          DateTime?
  uploadedAt       DateTime      @default(now())
  expiresAt        DateTime?
  isDeleted        Boolean       @default(false)
  deletedAt        DateTime?
  deletedByUserId  String?       @db.Uuid
  deletionReason   String?
  attendance       AttendanceLog @relation(fields: [attendanceId], references: [id])
  deletedByUser    User?         @relation("DeletedByUser", fields: [deletedByUserId], references: [id])
  uploadedByUser   User          @relation("UploadedByUser", fields: [uploadedByUserId], references: [id])

  @@index([attendanceId])
  @@map("attendance_evidence")
}
